stages:
  - fastdl
  - compile_plugins
  - genyml
  - trigger
  #- pull
  #- build

fastdl:
  stage: fastdl
  script: ./scripts/_0-fastdl.sh
  needs: []
  tags:
  - fastdl
  #only:
  #- master
  #- staging
  #- mvm

compile_plugins:
  stage: compile_plugins
  script: ./scripts/ci.sh build
  needs: []
  tags:
  - worker
  #only:
  #- master
  #- staging
  #- mvm

# this generates our yml so we don't run on more servers than needed
generate-yml:
  stage: genyml
  script: ./scripts/_0-genyml.sh | tee cfg.yml
  artifacts:
    paths:
      - cfg.yml
  tags:
    - worker
  needs: [compile_plugins]

trigger-ci:
  stage: trigger
  trigger:
    include:
      - artifact: cfg.yml
        job: generate-yml
  needs: [generate-yml]


